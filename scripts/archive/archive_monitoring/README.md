# Archive Monitoring

## **Основные функции**

- Проверка архива за последние N дней
- Проверка архива за последние N часов 

## **Установка**

- Перейти в автоматизацию, нажать «Загрузить пример» и выбрать «Из файла», указав путь к скрипту.
- Снять галочку «Включить скрипт» и нажать сохранить.
- Выбрать каналы дли мониторинга архива (если после оставить пустым - мониторинг осуществляется по всем каналам на сервере).
- Задать опционально временные интервалы мониторинга и типы потоков.
- Выполнить настройку и нажать "Сохранить и запустить"

## **Настройка**

![image2020-11-18_13-1-45.png](https://confluence.trassir.com/download/attachments/58657902/image2020-11-18_13-1-45.png?version=1&modificationDate=1605693705000&api=v2)

- Channels - выбор каналов, если поле оставить пустым проверяем архив по всем каналам на сервере

- E-mail account - аккаунт созданный в ПО Trassir

- E-Mail Recipients - получатели, через запятую

- E-Mail subject - тема письма, в качестве значения server_name будет подставлено имя сервера

- Work schedule (red) - выбор расписания для информирования по почте ( данное поле опциональное ), рабочим цветом считается - красный. 

- DEBUG - режим отладки

- Check archive by days - проверка архива по дням (наличие архива на канале за предыдущие сутки)

  - Check main stream - проверка основного потока

  - Check sub stream - проверка суб потока

  - Last N days - значение указывает за сколько последних дней происходит проверка архива, например если значение выставить 1 при запуске проверки 19.01.2021 будет совершена проверка за последние полные сутки 18.01.2021, при значении 3 за 16.01.2021,17.01.2021,18.01.2021

  - Check daily at(hours:minutes) - ежедневная проверка архива за предыдущий день/дни в заданное время

  > Check daily at(hours:minutes) - рекомендуем выставлять значения 8:00 и позже, для избежания ложных тревог

- Check archive for the last hours

  - Check main stream - проверка основного потока

  - Check sub stream - проверка суб потока

  - Last N hours - значение указывает за сколько последних часов происходит проверка архива

  > Проверка архива за предыдущий час/часы происходит через 15 минут после наступления нового &quot;часа&quot;. Данная задержка необходима для окончательного формирования статистики.

**При отсутствии архива - скрипт генерирует событие на сервере с следующими параметрами:**

- Тип потока

- Имя канала

- Временной интервал

  

  ![image2020-4-27_9-20-35.png](https://confluence.trassir.com/download/attachments/58657902/image2020-4-27_9-20-35.png?version=1&modificationDate=1587968434000&api=v2)
  
  

Если указан E-mail account и E-Mail Recipients происходит отправка писем следующего содержания:

![image2020-7-6_14-17-9.png](https://confluence.trassir.com/download/attachments/58657902/image2020-7-6_14-17-9.png?version=1&modificationDate=1594034228000&api=v2)

